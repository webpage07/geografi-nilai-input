<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Input Nilai Geografi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden-admin-icon {
            opacity: 0.1;
            transition: opacity 0.3s ease;
        }
        .hidden-admin-icon:hover {
            opacity: 1;
        }
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            animation: fadeInOut 3s ease-in-out;
        }
        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0;
            }
            10%, 90% {
                opacity: 1;
            }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">
    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <!-- Welcome Page -->
    <div id="welcomePage" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
            <div class="mb-6">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-green-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.84L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.84l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Selamat Datang di</h1>
                <p class="text-gray-600 mb-1">Sistem Input Nilai Online</p>
                <p class="text-lg font-semibold text-blue-600">Geografi</p>
                <p class="text-sm text-gray-500 mt-2">by Ali Imron</p>
            </div>
            <button onclick="goToDashboard()" class="w-full bg-gradient-to-r from-blue-500 to-green-500 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-600 hover:to-green-600 transition duration-300 transform hover:scale-105">
                Mulai
            </button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Dashboard</h1>
                    <p class="text-gray-600">Pilih menu untuk melanjutkan</p>
                </div>
                
                <div class="max-w-md mx-auto">
                    <!-- Unified Login Form -->
                    <div class="bg-gradient-to-br from-blue-50 to-green-50 p-8 rounded-xl">
                        <div class="text-center mb-6">
                            <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-green-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Login Sistem</h2>
                            <p class="text-gray-600">Masuk sebagai siswa atau admin</p>
                        </div>
                        
                        <!-- Login Type Selector -->
                        <div class="mb-6">
                            <div class="flex bg-gray-100 rounded-lg p-1">
                                <button id="studentTab" onclick="switchLoginType('student')" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition duration-300 bg-white text-blue-600 shadow-sm">
                                    Siswa
                                </button>
                                <button id="adminTab" onclick="switchLoginType('admin')" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition duration-300 text-gray-600 hover:text-gray-800">
                                    Admin
                                </button>
                            </div>
                        </div>
                        
                        <!-- Student Login Form -->
                        <div id="studentLoginForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">NISN Siswa</label>
                                <input type="text" id="studentNISN" placeholder="Masukkan NISN" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <button onclick="loginStudent()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition duration-300 transform hover:scale-105">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>Login Siswa</span>
                                </div>
                            </button>
                        </div>
                        
                        <!-- Admin Login Form -->
                        <div id="adminLoginForm" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password Admin</label>
                                <input type="password" id="adminPassword" placeholder="Masukkan password admin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>
                            <button onclick="loginAdmin()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition duration-300 transform hover:scale-105">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>Login Admin</span>
                                </div>
                            </button>
                        </div>
                        
                        <!-- Login Info -->
                        <div class="mt-6 text-center">
                            <div id="studentInfo" class="text-sm text-gray-600">
                                <p class="mb-1">Masukkan NISN untuk login sebagai siswa</p>
                                <p class="text-xs text-gray-500">Contoh: 0012345678</p>
                            </div>
                            <div id="adminInfo" class="hidden text-sm text-gray-600">
                                <p class="mb-1">Masukkan password untuk akses admin</p>
                                <p class="text-xs text-gray-500">Hanya untuk administrator</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Page -->
    <div id="studentPage" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Halaman Siswa</h1>
                        <p class="text-gray-600" id="studentInfo">Selamat datang, <span id="studentName"></span></p>
                    </div>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300">
                        Logout
                    </button>
                </div>

                <!-- Compact Student Profile Header -->
                <div class="bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-xl mb-8">
                    <div class="flex items-center space-x-4">
                        <!-- Profile Photo -->
                        <div class="relative">
                            <div id="profilePhotoContainer" class="w-16 h-16 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center overflow-hidden">
                                <img id="profilePhoto" class="w-full h-full object-cover hidden" alt="Foto Profil">
                                <svg id="defaultAvatar" class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <button onclick="changeProfilePhoto()" class="absolute -bottom-1 -right-1 bg-blue-500 text-white p-1.5 rounded-full hover:bg-blue-600 transition duration-300">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                </svg>
                            </button>
                            <input type="file" id="profilePhotoInput" accept="image/*" class="hidden" onchange="updateProfilePhoto()">
                        </div>
                        
                        <!-- Student Info -->
                        <div class="flex-1">
                            <h2 class="text-xl font-bold text-gray-800" id="profileName"></h2>
                            <div class="flex items-center space-x-4 mt-1 text-sm text-gray-600">
                                <span class="flex items-center space-x-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zM8 6a2 2 0 114 0v1H8V6z" clip-rule="evenodd"/>
                                    </svg>
                                    <span id="profileNISN"></span>
                                </span>
                                <span class="flex items-center space-x-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.84L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.84l-7-3z"/>
                                    </svg>
                                    <span id="profileClass"></span>
                                </span>
                                <span class="flex items-center space-x-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                    </svg>
                                    <span id="profileGender"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-3 gap-8">

                    <!-- Input Form -->
                    <div class="lg:col-span-2 bg-gray-50 p-6 rounded-xl">
                        <h2 class="text-xl font-bold text-gray-800 mb-6">Form Input Nilai</h2>
                        
                        <div class="space-y-6">
                            <!-- File Upload -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Unggah Bukti (JPG, JPEG, PNG - Max 1MB)</label>
                                <input type="file" id="fileUpload" accept=".jpg,.jpeg,.png" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Maksimal ukuran file 1MB</p>
                            </div>

                            <!-- Grade Type -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Nilai</label>
                                <select id="gradeType" onchange="toggleGradeInput()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Pilih jenis nilai</option>
                                    <option value="angka">Nilai Angka</option>
                                    <option value="huruf">Nilai Huruf</option>
                                </select>
                            </div>

                            <!-- Number Grade -->
                            <div id="numberGrade" class="hidden">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nilai Angka (0-100)</label>
                                <input type="number" id="numberValue" min="0" max="100" onchange="convertToLetter()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>

                            <!-- Letter Grade -->
                            <div id="letterGrade" class="hidden">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nilai Huruf</label>
                                <select id="letterValue" onchange="convertToNumber()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Pilih nilai huruf</option>
                                    <option value="A++">A++ (96-100)</option>
                                    <option value="A+">A+ (91-95)</option>
                                    <option value="A">A (86-90)</option>
                                    <option value="A-">A- (80-85)</option>
                                    <option value="B+">B+ (75-79)</option>
                                    <option value="B">B (70-74)</option>
                                    <option value="B-">B- (65-69)</option>
                                    <option value="C+">C+ (62-64)</option>
                                    <option value="C">C (60-61)</option>
                                    <option value="C-">C- (59)</option>
                                    <option value="D">D (<59)</option>
                                    <option value="E">E (0)</option>
                                </select>
                            </div>

                            <!-- Assignment Type -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bentuk Tugas</label>
                                <select id="assignmentType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Pilih bentuk tugas</option>
                                    <option value="Ulangan Harian">Ulangan Harian</option>
                                    <option value="Tugas Individu">Tugas Individu</option>
                                    <option value="Tugas Kelompok">Tugas Kelompok</option>
                                    <option value="Praktikum">Praktikum</option>
                                    <option value="Presentasi">Presentasi</option>
                                </select>
                            </div>

                            <button onclick="submitGrade()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-600 transition duration-300">
                                Kirim Data
                            </button>
                        </div>
                    </div>

                    <!-- Grade Summary -->
                    <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-xl">
                        <div class="text-center">
                            <h2 class="text-lg font-bold text-gray-800 mb-3">Rekap Nilai Saya</h2>
                            
                            <button onclick="loadAndShowGradeRecap()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-3 rounded-full hover:from-purple-600 hover:to-pink-600 transition duration-300 transform hover:scale-110 shadow-lg group">
                                <svg class="w-6 h-6 group-hover:animate-pulse" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                    <path d="M8,12V14H16V12H8M8,16V18H13V16H8Z"/>
                                </svg>
                            </button>
                            
                            <p class="text-xs text-gray-600 mt-2">Klik ikon untuk melihat rekap nilai</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Grade Recap Page -->
    <div id="detailedGradePage" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Rekap Nilai Detail</h1>
                        <p class="text-gray-600" id="detailedStudentInfo">Data lengkap nilai siswa</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="exportStudentGrades()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                                <span>Export</span>
                            </div>
                        </button>
                        <button onclick="backToStudentPage()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                                </svg>
                                <span>Kembali</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Student Profile Summary -->
                <div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-xl mb-8">
                    <div class="flex items-center space-x-6">
                        <div class="w-20 h-20 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-full flex items-center justify-center">
                            <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h2 class="text-2xl font-bold text-gray-800" id="detailedStudentName">-</h2>
                            <div class="grid grid-cols-3 gap-4 mt-3">
                                <div>
                                    <p class="text-xs text-gray-500 uppercase tracking-wide">NISN</p>
                                    <p class="font-semibold text-gray-800" id="detailedStudentNISN">-</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 uppercase tracking-wide">Kelas</p>
                                    <p class="font-semibold text-gray-800" id="detailedStudentClass">-</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 uppercase tracking-wide">Jenis Kelamin</p>
                                    <p class="font-semibold text-gray-800" id="detailedStudentGender">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-white p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-indigo-600" id="detailedTotalGrades">0</div>
                                    <div class="text-xs text-gray-500">Total Nilai</div>
                                </div>
                                <div class="bg-white p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-blue-600" id="detailedAverageGrade">-</div>
                                    <div class="text-xs text-gray-500">Rata-rata</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter and Search -->
                <div class="bg-gray-50 p-6 rounded-xl mb-8">
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Bentuk Tugas</label>
                            <select id="filterAssignmentType" onchange="filterGrades()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="">Semua Tugas</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Nilai Huruf</label>
                            <select id="filterLetterGrade" onchange="filterGrades()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="">Semua Nilai</option>
                                <option value="A++">A++ (96-100)</option>
                                <option value="A+">A+ (91-95)</option>
                                <option value="A">A (86-90)</option>
                                <option value="A-">A- (80-85)</option>
                                <option value="B+">B+ (75-79)</option>
                                <option value="B">B (70-74)</option>
                                <option value="B-">B- (65-69)</option>
                                <option value="C+">C+ (62-64)</option>
                                <option value="C">C (60-61)</option>
                                <option value="C-">C- (59)</option>
                                <option value="D">D (<59)</option>
                                <option value="E">E (0)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Urutkan Berdasarkan</label>
                            <select id="sortBy" onchange="filterGrades()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="date_desc">Tanggal (Terbaru)</option>
                                <option value="date_asc">Tanggal (Terlama)</option>
                                <option value="grade_desc">Nilai (Tertinggi)</option>
                                <option value="grade_asc">Nilai (Terendah)</option>
                                <option value="assignment">Bentuk Tugas</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4">
                        <button onclick="resetFilters()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300">
                            Reset Filter
                        </button>
                        <button onclick="refreshDetailedData()" class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition duration-300 ml-2">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                </svg>
                                <span>Refresh Data</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Grade Statistics -->
                <div class="grid md:grid-cols-6 gap-4 mb-8">
                    <div class="bg-emerald-50 p-4 rounded-lg text-center border-l-4 border-emerald-500">
                        <div class="text-2xl font-bold text-emerald-600" id="gradeCountA">0</div>
                        <div class="text-sm text-gray-600">Nilai A (86-100)</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center border-l-4 border-blue-500">
                        <div class="text-2xl font-bold text-blue-600" id="gradeCountB">0</div>
                        <div class="text-sm text-gray-600">Nilai B (65-79)</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg text-center border-l-4 border-yellow-500">
                        <div class="text-2xl font-bold text-yellow-600" id="gradeCountC">0</div>
                        <div class="text-sm text-gray-600">Nilai C (59-64)</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center border-l-4 border-orange-500">
                        <div class="text-2xl font-bold text-orange-600" id="gradeCountD">0</div>
                        <div class="text-sm text-gray-600">Nilai D (<59)</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center border-l-4 border-red-500">
                        <div class="text-2xl font-bold text-red-600" id="gradeCountE">0</div>
                        <div class="text-sm text-gray-600">Nilai E (0)</div>
                    </div>
                </div>

                <!-- Detailed Grade Table -->
                <div class="bg-white rounded-xl border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">Daftar Nilai Lengkap</h3>
                        <p class="text-sm text-gray-600 mt-1">Nilai diambil langsung dari Database Nilai</p>
                    </div>
                    
                    <div id="detailedGradeContent" class="p-6">
                        <div class="text-center py-12">
                            <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <p class="text-gray-500 font-medium">Memuat data nilai...</p>
                            <p class="text-gray-400 text-sm mt-1">Mohon tunggu sebentar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Page -->
    <div id="adminPage" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Panel Admin</h1>
                        <p class="text-gray-600">Kelola sistem input nilai geografi</p>
                    </div>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300">
                        Logout
                    </button>
                </div>

                <!-- Admin Profile -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl mb-8">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">Ali Imron</h2>
                            <p class="text-gray-600">Administrator Sistem</p>
                            <p class="text-sm text-gray-500">Guru Geografi</p>
                        </div>
                    </div>
                </div>

                <!-- Admin Menu -->
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <button onclick="showChangePassword()" class="bg-yellow-100 hover:bg-yellow-200 p-6 rounded-xl text-center transition duration-300">
                        <div class="w-12 h-12 bg-yellow-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-800">Ganti Password</h3>
                    </button>

                    <button onclick="showStudentManagement()" class="bg-blue-100 hover:bg-blue-200 p-6 rounded-xl text-center transition duration-300">
                        <div class="w-12 h-12 bg-blue-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-800">Kelola Siswa</h3>
                    </button>

                    <button onclick="showAssignmentManagement()" class="bg-green-100 hover:bg-green-200 p-6 rounded-xl text-center transition duration-300">
                        <div class="w-12 h-12 bg-green-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-800">Kelola Tugas</h3>
                    </button>

                    <button onclick="showGradeRecap()" class="bg-purple-100 hover:bg-purple-200 p-6 rounded-xl text-center transition duration-300">
                        <div class="w-12 h-12 bg-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 000 2h11.586l-2.293 2.293a1 1 0 001.414 1.414L16 7.414V19a1 1 0 102 0V7.414l2.293 2.293a1 1 0 001.414-1.414L19.414 6H20a1 1 0 100-2H3z"/>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-800">Rekap Nilai</h3>
                    </button>
                </div>

                <!-- Admin Content Area -->
                <div id="adminContent" class="bg-gray-50 p-6 rounded-xl">
                    <p class="text-gray-600 text-center">Pilih menu di atas untuk mengelola sistem</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Student Database
        const students = [
            {nisn: '0089934314', name: 'ABDUL KODIR ZAELANI', gender: 'L', class: 'XII B1'},
            {nisn: '0085206091', name: 'ADINDA HANDAYANI', gender: 'P', class: 'XII B1'},
            {nisn: '0086759103', name: 'ADJI NUGROHO', gender: 'L', class: 'XII B1'},
            {nisn: '0075028344', name: 'AHMAD FAHRI HUSEINI', gender: 'L', class: 'XII B1'},
            {nisn: '0079563924', name: 'AIDA DESTRIANI', gender: 'P', class: 'XII B1'},
            {nisn: '0085078879', name: 'AISYAH NUR ADZKIYA', gender: 'P', class: 'XII B1'},
            {nisn: '0078364495', name: 'BULAN KENCANA ARSYI SAGERI', gender: 'P', class: 'XII B1'},
            {nisn: '0071227610', name: 'CHIKA RAMADHANI', gender: 'P', class: 'XII B1'},
            {nisn: '0085919341', name: 'DANNYA MAULIDIA INDRESWARI', gender: 'P', class: 'XII B1'},
            {nisn: '0089709876', name: 'DENADHIF AZKA KEANDRA', gender: 'L', class: 'XII B1'},
            {nisn: '0085162278', name: 'DEWI CHANDRA KIRANA', gender: 'P', class: 'XII B1'},
            {nisn: '0072343073', name: 'DHAFIN AKBAR ALKAUTSAR', gender: 'L', class: 'XII B1'},
            {nisn: '0086417174', name: 'ELNIARA AZHURA', gender: 'P', class: 'XII B1'},
            {nisn: '0087974865', name: 'ESTER ROSLIANA CHRISTIN SIMANJUNTAK', gender: 'P', class: 'XII B1'},
            {nisn: '0079477911', name: 'FAREL BRIA', gender: 'L', class: 'XII B1'},
            {nisn: '0077049532', name: 'FERDY NURDIANSYAH', gender: 'L', class: 'XII B1'},
            {nisn: '0078645595', name: 'FIRDA KHOSIAH', gender: 'P', class: 'XII B1'},
            {nisn: '0076447327', name: 'GANGSAR CIPTO PANGESTU', gender: 'L', class: 'XII B1'},
            {nisn: '0077673375', name: 'GLADYS UNIKE NAOMI', gender: 'P', class: 'XII B1'},
            {nisn: '0081960894', name: 'GRISELDA BARDINAH RAISA', gender: 'P', class: 'XII B1'},
            {nisn: '0086099711', name: 'HALIMAH AZAHRA', gender: 'P', class: 'XII B1'},
            {nisn: '0071982360', name: 'HIDAYAT', gender: 'L', class: 'XII B1'},
            {nisn: '0075337127', name: 'IRZI DWI SAPUTRA', gender: 'L', class: 'XII B1'},
            {nisn: '0074749118', name: 'JELITA PUTRI MAHARANI', gender: 'P', class: 'XII B1'},
            {nisn: '0085963887', name: 'KEZIA SHABILA WANDIRA', gender: 'P', class: 'XII B1'},
            {nisn: '0082352173', name: 'MUHAMAD REFAN FEBRIAN', gender: 'L', class: 'XII B1'},
            {nisn: '0089934812', name: 'MUHAMAD RIZKY SYAHBUDIN', gender: 'L', class: 'XII B1'},
            {nisn: '0084786812', name: 'MUHAMAD SYAH REZA BAHARI', gender: 'L', class: 'XII B1'},
            {nisn: '0083407044', name: 'MUHAMMAD FAISAL', gender: 'L', class: 'XII B1'},
            {nisn: '0081918290', name: 'MUHAMMAD RAFFI DWI PRASETYO', gender: 'L', class: 'XII B1'},
            {nisn: '0088502026', name: 'NABILA PUTRI RAMADANI', gender: 'P', class: 'XII B1'},
            {nisn: '0078764434', name: 'NATHANAEL OZIAS PARDEDE', gender: 'L', class: 'XII B1'},
            {nisn: '0078265715', name: 'NAUFAL SATRIAWAN', gender: 'L', class: 'XII B1'},
            {nisn: '0071311428', name: 'NAZWA AULIA', gender: 'P', class: 'XII B1'},
            {nisn: '0075057146', name: 'RAISHA NADINE', gender: 'P', class: 'XII B1'},
            {nisn: '0088351455', name: 'RAYHAN FAREL AGSANDIHARJO', gender: 'L', class: 'XII B1'},
            {nisn: '0073763458', name: 'RISYAD SYAFATULLAH', gender: 'L', class: 'XII B1'},
            {nisn: '0088253430', name: 'RIZKA RAHMADHANI', gender: 'P', class: 'XII B1'},
            {nisn: '0079013201', name: 'SAHLAN PRAYOGA ABDUL ROZAQ', gender: 'L', class: 'XII B1'},
            {nisn: '0089489547', name: 'SHERIN SEPTIA FITRI', gender: 'P', class: 'XII B1'},
            {nisn: '0076231841', name: 'SULTAN ADHI IRAWAN', gender: 'L', class: 'XII B1'},
            {nisn: '0084381471', name: 'WAHYU DIRGANTARA DWI PUTRA', gender: 'L', class: 'XII B1'},
            {nisn: '0149889614', name: 'ZAHRA AWWALIYA MALVA', gender: 'P', class: 'XII B1'},
            {nisn: '0084182685', name: 'ZULFIKAR ARRAFI', gender: 'L', class: 'XII B1'},
            {nisn: '0072563501', name: 'ABI NUR WAHID', gender: 'L', class: 'XII B2'},
            {nisn: '0088323824', name: 'AL FATHIR LANGIT RIVAI', gender: 'L', class: 'XII B2'},
            {nisn: '0075965363', name: 'ALFANSYAH PRASETIYO WARYONO', gender: 'L', class: 'XII B2'},
            {nisn: '0085261355', name: 'ARIAPUTRA EKA WIJAYA', gender: 'L', class: 'XII B2'},
            {nisn: '0081025909', name: 'AULIA ZAHRA SYAFIRA', gender: 'P', class: 'XII B2'},
            {nisn: '0082538332', name: 'AZZAH ZAHIRAH', gender: 'P', class: 'XII B2'},
            {nisn: '0079855110', name: 'CINDY NUR AINI', gender: 'P', class: 'XII B2'},
            {nisn: '0082536636', name: 'DAVA ALFA REZA', gender: 'L', class: 'XII B2'},
            {nisn: '0079230441', name: 'EZZAR RADITYA', gender: 'L', class: 'XII B2'},
            {nisn: '0085461426', name: 'FARDHAN SYAKI', gender: 'L', class: 'XII B2'},
            {nisn: '0073605476', name: 'FARREL FERDIANSYAH', gender: 'L', class: 'XII B2'},
            {nisn: '0082115256', name: 'FAYESHA HAPPY CALISTHA', gender: 'P', class: 'XII B2'},
            {nisn: '0078312129', name: 'FITRI OKTAVIANTI', gender: 'P', class: 'XII B2'},
            {nisn: '0084599495', name: 'GHAISANI HANANIA PUTRI TRISNALDI', gender: 'P', class: 'XII B2'},
            {nisn: '0079975460', name: 'GILANG RAMADHAN', gender: 'L', class: 'XII B2'},
            {nisn: '0073715928', name: 'HANIFA AISYAH PUTRI', gender: 'P', class: 'XII B2'},
            {nisn: '0072753346', name: 'IMANUEL CHRISTIAN ROSADY', gender: 'L', class: 'XII B2'},
            {nisn: '0082462329', name: 'IZZATI KARIMA', gender: 'P', class: 'XII B2'},
            {nisn: '0084261535', name: 'JULIA SESA KAMILA', gender: 'P', class: 'XII B2'},
            {nisn: '0082708693', name: 'KEZIA RAHMANIA PUTRI', gender: 'P', class: 'XII B2'},
            {nisn: '0088840616', name: 'KHALMA NURDIN AL AYUBI', gender: 'P', class: 'XII B2'},
            {nisn: '0082385969', name: 'KINANTI PRAMESWARI', gender: 'P', class: 'XII B2'},
            {nisn: '0072124303', name: 'MAHARA ARDITYA MUHAMAD', gender: 'L', class: 'XII B2'},
            {nisn: '0089353367', name: 'MARCO IBAS SILO TARIGAN', gender: 'L', class: 'XII B2'},
            {nisn: '0085888887', name: 'MOCHAMMAD AZ-ZAHRI', gender: 'L', class: 'XII B2'},
            {nisn: '0088569836', name: 'MUHAMAD SHAFDAR AZMI', gender: 'L', class: 'XII B2'},
            {nisn: '0084947568', name: 'MUHAMMAD ALTHAF', gender: 'L', class: 'XII B2'},
            {nisn: '0077571997', name: 'MUHAMMAD HILMI ZAHIR', gender: 'L', class: 'XII B2'},
            {nisn: '0081091231', name: 'NADIA AYU HIKMATUN NAJWA', gender: 'P', class: 'XII B2'},
            {nisn: '0074353400', name: 'NEIZA KAYLA AZ ZAHRA', gender: 'P', class: 'XII B2'},
            {nisn: '0071761473', name: 'NOFRIZA ARFAN MAULANA', gender: 'L', class: 'XII B2'},
            {nisn: '0084671589', name: 'NUFIKHA HAERUNITA', gender: 'P', class: 'XII B2'},
            {nisn: '0082860045', name: 'NURUD DINIYYAH AL MARATUS SHOLIHAH', gender: 'P', class: 'XII B2'},
            {nisn: '0083734229', name: 'RAFI MAULANA', gender: 'L', class: 'XII B2'},
            {nisn: '0098273239', name: 'RAFINZA HAFIZH', gender: 'L', class: 'XII B2'},
            {nisn: '0074984779', name: 'RAISSA PUTRI KAMILA', gender: 'P', class: 'XII B2'},
            {nisn: '0085806225', name: 'RIFA KHOIRUL AZZAM', gender: 'L', class: 'XII B2'},
            {nisn: '0081323808', name: 'RIZKY RAJA NUR LATIF', gender: 'L', class: 'XII B2'},
            {nisn: '0078941822', name: 'RIZQI FADHILAH', gender: 'L', class: 'XII B2'},
            {nisn: '0079445981', name: 'SITI AULIYA', gender: 'P', class: 'XII B2'},
            {nisn: '0089159227', name: 'THIANKANNORA HARYA BALQISSALMA', gender: 'P', class: 'XII B2'},
            {nisn: '0073533657', name: 'TRI CAHYA JULIA MARLIN', gender: 'P', class: 'XII B2'},
            {nisn: '0074260641', name: 'TSABITA ALYA YASMIN', gender: 'P', class: 'XII B2'},
            {nisn: '0089871405', name: 'VALESKA ALGI FARROS', gender: 'L', class: 'XII B2'},
            {nisn: '0097758369', name: 'AIRA PUTRI OKTAVIANI', gender: 'P', class: 'X1'},
            {nisn: '0097931054', name: 'AIRISH BILAL NABAWI', gender: 'L', class: 'X1'},
            {nisn: '0093693520', name: 'ALDHO JUNADIL ILHAM', gender: 'L', class: 'X1'},
            {nisn: '0103307505', name: 'ALICIA PUTRI DEVINIRA', gender: 'P', class: 'X1'},
            {nisn: '3104682093', name: 'ANIDA JIHAN FIDIYA', gender: 'P', class: 'X1'},
            {nisn: '0102108205', name: 'ANNISA NUR SYIFA', gender: 'P', class: 'X1'},
            {nisn: '0102371225', name: 'ARYA BHIMA SUTANARENDRA HADIUSODO', gender: 'L', class: 'X1'},
            {nisn: '0094238385', name: 'AYRA DIAH AGNESA', gender: 'P', class: 'X1'},
            {nisn: '0105461165', name: 'AZHAR HIDAYAT DHARMA ATMOKO', gender: 'L', class: 'X1'},
            {nisn: '0097206174', name: 'CAHYA KAMILA', gender: 'P', class: 'X1'},
            {nisn: '0095735226', name: 'CARISSA ARUNI WIDYADHANA', gender: 'P', class: 'X1'},
            {nisn: '0101727711', name: 'CHESTA KAYNA MOZABI', gender: 'P', class: 'X1'},
            {nisn: '0099748269', name: 'DIKA PERMANA', gender: 'L', class: 'X1'},
            {nisn: '0098744140', name: 'FANIA RAHMALIA', gender: 'P', class: 'X1'},
            {nisn: '0096547231', name: 'FARELL ABYANSYAH', gender: 'L', class: 'X1'},
            {nisn: '0091486788', name: 'FATIMAH AZARIA', gender: 'P', class: 'X1'},
            {nisn: '0094064577', name: 'KAYSA AYUDYA FIQQI', gender: 'P', class: 'X1'},
            {nisn: '0098135381', name: 'LISA AZAHRA', gender: 'P', class: 'X1'},
            {nisn: '3102918071', name: 'LUTHFIATUL AMALIA', gender: 'P', class: 'X1'},
            {nisn: '3095959925', name: 'MUCHAMMAD FATIR RISTANDY', gender: 'L', class: 'X1'},
            {nisn: '0094311032', name: 'MUHAMAD ARYA DWIYANTO', gender: 'L', class: 'X1'},
            {nisn: '3090453929', name: 'MUHAMMAD FIRDAUS FASYA', gender: 'L', class: 'X1'},
            {nisn: '0091307413', name: 'MUHAMMAD GIBRAN ALGHAZALI SIREGAR', gender: 'L', class: 'X1'},
            {nisn: '0102362324', name: 'NAIFAH UMAIROH PUTRI', gender: 'P', class: 'X1'},
            {nisn: '0107806883', name: 'NATASYA HAFIZHAH SALSABILA', gender: 'P', class: 'X1'},
            {nisn: '0097087570', name: 'NAYSHYA NURHAFIZAH', gender: 'P', class: 'X1'},
            {nisn: '0109362636', name: 'RAFA ARDIYANSAH', gender: 'L', class: 'X1'},
            {nisn: '3094988596', name: 'RAFAEL AGUERO HARYANTO', gender: 'L', class: 'X1'},
            {nisn: '0104434585', name: 'RAFFI ALVINO', gender: 'L', class: 'X1'},
            {nisn: '0103753613', name: 'RASMANA PUTRA', gender: 'L', class: 'X1'},
            {nisn: '0106446196', name: 'RENATTA NADIA ANAK PERMANA', gender: 'P', class: 'X1'},
            {nisn: '0093309540', name: 'RIZKY YUGO RAMADHAN', gender: 'L', class: 'X1'},
            {nisn: '0095353888', name: 'SADATAIN AINUN FAJRIAH', gender: 'P', class: 'X1'},
            {nisn: '0102264279', name: 'SAHJAH SAKILAH DINIA', gender: 'P', class: 'X1'},
            {nisn: '0098999904', name: 'THALITA ROSIANA SAPUTRO', gender: 'P', class: 'X1'},
            {nisn: '0099411978', name: 'ZAKARIA BARI BIAN SAMUDRA', gender: 'L', class: 'X1'},
            {nisn: '0102625660', name: 'ABBYGAIL ANASTASYA RANTEALANG', gender: 'P', class: 'X2'},
            {nisn: '0091558523', name: 'ABISTA PUTRATAMA GUNAWAN', gender: 'L', class: 'X2'},
            {nisn: '0099168381', name: 'ALISYA SYORS WIJAYA', gender: 'P', class: 'X2'},
            {nisn: '0107760969', name: 'ALIYAH MALSA NAFIAH', gender: 'P', class: 'X2'},
            {nisn: '0087568314', name: 'ALVIN FAIZ ADITYA', gender: 'L', class: 'X2'},
            {nisn: '0167150180', name: 'ANINDYA KHALISAH PUTRI', gender: 'P', class: 'X2'},
            {nisn: '0099444906', name: 'ATAYA KEANDRE PUTRA', gender: 'P', class: 'X2'},
            {nisn: '3107367993', name: 'ATHAR CAKRA FAEYZA', gender: 'L', class: 'X2'},
            {nisn: '0097093809', name: 'AZKI ALFIKRA', gender: 'L', class: 'X2'},
            {nisn: '0109449845', name: 'BAGAS ADI SAPUTRA', gender: 'L', class: 'X2'},
            {nisn: '0094211904', name: 'CAMELLIA PUTRI SABINA', gender: 'P', class: 'X2'},
            {nisn: '0096962983', name: 'CIARA LARAS HARWANTO', gender: 'P', class: 'X2'},
            {nisn: '0097253265', name: 'CYANARA ARETHA PUTRIANTO', gender: 'P', class: 'X2'},
            {nisn: '0106492133', name: 'DARA AVIRA SHANALIA', gender: 'P', class: 'X2'},
            {nisn: '0095612535', name: 'DIMITRY GALANG ARCHIECO TIMOTHY SIMAMORA', gender: 'L', class: 'X2'},
            {nisn: '0098746677', name: 'FAUZAN MUNIF RAMADHAN', gender: 'L', class: 'X2'},
            {nisn: '0107642273', name: 'FEBY WIJAYA PUTRI', gender: 'P', class: 'X2'},
            {nisn: '0093244375', name: 'GHUMAISHA AZKA ALVIENA', gender: 'P', class: 'X2'},
            {nisn: '0102000716', name: 'MARITZA ALIFIA BACHFEN', gender: 'P', class: 'X2'},
            {nisn: '0099040179', name: 'MAUZA AYU NOVITA', gender: 'P', class: 'X2'},
            {nisn: '0103602951', name: 'MEIRA NUR AZIZAH', gender: 'P', class: 'X2'},
            {nisn: '0099028840', name: 'MUHAMAD ROBBY TRIANANTA', gender: 'L', class: 'X2'},
            {nisn: '0091093602', name: 'MUHAMMAD IBRAHIM RAMADHAN', gender: 'L', class: 'X2'},
            {nisn: '0092483713', name: 'MUHAMMAD RIDHO EVIN', gender: 'L', class: 'X2'},
            {nisn: '0104303947', name: 'NAILA DEVIKA SUHENDAR', gender: 'P', class: 'X2'},
            {nisn: '0099834656', name: 'NAURA RANA NADHIFA', gender: 'P', class: 'X2'},
            {nisn: '0096407052', name: 'RAHARDIAN GIRINDRA WARDANA', gender: 'L', class: 'X2'},
            {nisn: '0108919337', name: 'RAIZ BRILLIANTAMA', gender: 'L', class: 'X2'},
            {nisn: '0094416493', name: 'RASYAH RESKY ADITYA ALHARUN', gender: 'L', class: 'X2'},
            {nisn: '0097976235', name: 'RHENITA APRILIA', gender: 'P', class: 'X2'},
            {nisn: '0096453236', name: 'SALSABILA F S', gender: 'P', class: 'X2'},
            {nisn: '0096448036', name: 'SHAIRA RAMADHANI', gender: 'P', class: 'X2'},
            {nisn: '0093701906', name: 'SYAFA DWI ARIANI', gender: 'P', class: 'X2'},
            {nisn: '0101396427', name: 'THIARA MUTMAINAH FIKRI', gender: 'P', class: 'X2'},
            {nisn: '0095314769', name: 'TITO PUTRA LESTIYANTO', gender: 'L', class: 'X2'},
            {nisn: '0099988225', name: 'TSAMARA AZKA ANINDITA', gender: 'P', class: 'X2'},
            {nisn: '0092211429', name: 'ABDULHAFIZ FADLAN ATORI', gender: 'L', class: 'X3'},
            {nisn: '0108041760', name: 'AFIF AHMAD', gender: 'L', class: 'X3'},
            {nisn: '0103251329', name: 'AISYAH ANAIA SANTOSO', gender: 'P', class: 'X3'},
            {nisn: '0109242075', name: 'ALMIRA DZAKIYAH THALITA SAKHI', gender: 'P', class: 'X3'},
            {nisn: '0108071652', name: 'ALYSSA PUTRI KAUTSAR', gender: 'P', class: 'X3'},
            {nisn: '0091591105', name: 'AMAR RIZQY', gender: 'L', class: 'X3'},
            {nisn: '0093725431', name: 'ANJANI NUR FATMAWATI', gender: 'P', class: 'X3'},
            {nisn: '0095588484', name: 'AURELIA CAHYA RAMADHANI', gender: 'P', class: 'X3'},
            {nisn: '0098010850', name: 'BAGUS ARYO SENO', gender: 'L', class: 'X3'},
            {nisn: '0104329848', name: 'BHANU SIKARA SAHASRADASA', gender: 'L', class: 'X3'},
            {nisn: '0105364796', name: 'BILQIS SYIAMI HASIANI SILALAHI', gender: 'P', class: 'X3'},
            {nisn: '0108122400', name: 'CATUR TEGUH SYAHBANA', gender: 'L', class: 'X3'},
            {nisn: '3108371114', name: 'CITRA AMIRAH PUTRI', gender: 'P', class: 'X3'},
            {nisn: '0109722014', name: 'DAVINA SALSABILLA ITSAR', gender: 'P', class: 'X3'},
            {nisn: '3107517403', name: 'DELICIA ATHAYA ZAINA', gender: 'P', class: 'X3'},
            {nisn: '0103665889', name: 'FAHISHA RAHMADHITA', gender: 'P', class: 'X3'},
            {nisn: '0091779583', name: 'FARIZ YUSUF', gender: 'L', class: 'X3'},
            {nisn: '0092029602', name: 'FIDELIA AAQILAH RISTA', gender: 'P', class: 'X3'},
            {nisn: '0101502053', name: 'GLADIZA KEILA PUTRI MODJO', gender: 'P', class: 'X3'},
            {nisn: '0096337476', name: 'HABIBULLAH ASSYAUQI', gender: 'L', class: 'X3'},
            {nisn: '0099724818', name: 'MARSYANDA AURELIA PEPPY', gender: 'P', class: 'X3'},
            {nisn: '0108477368', name: 'MILINKA PUTRI ALETHA RACHMAN', gender: 'P', class: 'X3'},
            {nisn: '0091287841', name: 'MUHAMAD RASYA HIDAYAH', gender: 'L', class: 'X3'},
            {nisn: '0091376116', name: 'MUHAMMAD NUR ARIF RAMADHAN', gender: 'L', class: 'X3'},
            {nisn: '0099805128', name: 'MUHAMMAD RASYA ABIDZAR ARKANANTA', gender: 'L', class: 'X3'},
            {nisn: '3092143664', name: 'MUHAMMAD ZAKHWAN ALFATHAH', gender: 'L', class: 'X3'},
            {nisn: '0087798529', name: 'NADYA PUSPITA ANGGRAENI', gender: 'P', class: 'X3'},
            {nisn: '0107513403', name: 'NAURA SOFIATUL NADHIFA', gender: 'P', class: 'X3'},
            {nisn: '0098426051', name: 'RAHEL FAHRIZA MANSUR', gender: 'L', class: 'X3'},
            {nisn: '0106344566', name: 'RIDHO PRASETYO', gender: 'L', class: 'X3'},
            {nisn: '0097921499', name: 'RISELLA AFIANTY', gender: 'P', class: 'X3'},
            {nisn: '0099805667', name: 'SALSABILA ZAHRAN', gender: 'P', class: 'X3'},
            {nisn: '0105588499', name: 'SHEREEN NATHANIA', gender: 'P', class: 'X3'},
            {nisn: '0102688254', name: 'TANTRA ARDELIA BERNADINE', gender: 'P', class: 'X3'},
            {nisn: '0093051480', name: 'VANESA QOTRUN NADA', gender: 'P', class: 'X3'},
            {nisn: '0108496095', name: 'YASMINE FITRIA AZZAHRA', gender: 'P', class: 'X3'},
            {nisn: '0099029847', name: 'AHMAD ARGA FAIRUS', gender: 'L', class: 'X4'},
            {nisn: '0091307556', name: 'ALIF RASYDAN ATHALLAH', gender: 'L', class: 'X4'},
            {nisn: '0093712556', name: 'ALANA TSAMARA IWAN', gender: 'P', class: 'X4'},
            {nisn: '0109922111', name: 'ALYA GENDISPUTRI DESTIAN', gender: 'P', class: 'X4'},
            {nisn: '0095481451', name: 'ANDIRA AURELYA', gender: 'P', class: 'X4'},
            {nisn: '0091607323', name: 'ANNISA NURDIYANTI', gender: 'P', class: 'X4'},
            {nisn: '0102955222', name: 'ARDIKA PUTRA TRISTIAN', gender: 'L', class: 'X4'},
            {nisn: '0094531604', name: 'AYESHA PUTRI SAHIRA', gender: 'P', class: 'X4'},
            {nisn: '0098848140', name: 'BRIAN SAPUTRA', gender: 'L', class: 'X4'},
            {nisn: '0104081660', name: 'DAFFA IRFANTO', gender: 'L', class: 'X4'},
            {nisn: '0099220871', name: 'DEWI PARAMITHA', gender: 'P', class: 'X4'},
            {nisn: '0093974023', name: 'DHEA AINNUR PUTRI', gender: 'P', class: 'X4'},
            {nisn: '0099448254', name: 'DIANDRA SEKAR ARUM', gender: 'P', class: 'X4'},
            {nisn: '0114954287', name: 'FAIRUZ IZDIHAR QURATA AIN', gender: 'L', class: 'X4'},
            {nisn: '0099608532', name: 'FRISKA NATASIA', gender: 'P', class: 'X4'},
            {nisn: '0093306639', name: 'GHAIDA KHAIRUNNISA', gender: 'P', class: 'X4'},
            {nisn: '0107046320', name: 'HAFIDZ RAFI RABBANI', gender: 'L', class: 'X4'},
            {nisn: '0094774561', name: 'HELMI SATRIA ABADI', gender: 'L', class: 'X4'},
            {nisn: '0096667174', name: 'KARIMA NAILA ZAKIYAH', gender: 'P', class: 'X4'},
            {nisn: '0108630391', name: 'MIRACLE JASMINE', gender: 'P', class: 'X4'},
            {nisn: '0104404115', name: 'MIRANDA NOVA', gender: 'P', class: 'X4'},
            {nisn: '0094286368', name: 'MUHAMAD RIZKI', gender: 'L', class: 'X4'},
            {nisn: '0101736596', name: 'MUHAMMAD RAFA HEROKU', gender: 'L', class: 'X4'},
            {nisn: '0109926660', name: 'MUHAMMAD ZACHRON ARAFI KWINTO', gender: 'L', class: 'X4'},
            {nisn: '0097628186', name: 'MUHAMMAD ZIKRI ALGIFARI', gender: 'L', class: 'X4'},
            {nisn: '0106603503', name: 'NATASYA DWI SISWANTI', gender: 'P', class: 'X4'},
            {nisn: '0095660229', name: 'NAZWA CINTA CHAIRUNNISA', gender: 'P', class: 'X4'},
            {nisn: '3100104031', name: 'NAZWA KEYLA VERLITA', gender: 'P', class: 'X4'},
            {nisn: '0092827034', name: 'RAKA PANDAWA SAPUTRA', gender: 'L', class: 'X4'},
            {nisn: '0094436409', name: 'RAYMONDUS HORAS HUTAURUK', gender: 'L', class: 'X4'},
            {nisn: '0101841546', name: 'RIVALDY AL-GHOFARI', gender: 'L', class: 'X4'},
            {nisn: '0094719033', name: 'SALZA ANGGRAENI', gender: 'P', class: 'X4'},
            {nisn: '0103534846', name: 'SEKAR AYUANDITA', gender: 'P', class: 'X4'},
            {nisn: '0104582597', name: 'SINDY MARCYKA PUTRI', gender: 'P', class: 'X4'},
            {nisn: '3104695496', name: 'WISYA RAZQIYAH MAHIRA', gender: 'P', class: 'X4'},
            {nisn: '0097678115', name: 'ZAHRA HANIFAH', gender: 'P', class: 'X4'},
            {nisn: '0101410719', name: 'AHMAD FAQIH ARAFAT', gender: 'L', class: 'X5'},
            {nisn: '0094988219', name: 'ALFHAN SYAFA', gender: 'L', class: 'X5'},
            {nisn: '0095952879', name: 'ALIKA NOVI FAJRINA HERMANTO', gender: 'P', class: 'X5'},
            {nisn: '0094079410', name: 'AMANDA CANTIKA KHAIRUNNISA', gender: 'P', class: 'X5'},
            {nisn: '0106868406', name: 'AQILLA ZARA NAFISA', gender: 'P', class: 'X5'},
            {nisn: '0098776918', name: 'ARIQA FATINA NAILA', gender: 'P', class: 'X5'},
            {nisn: '0104988315', name: 'AZKA ANINDIA', gender: 'P', class: 'X5'},
            {nisn: '3093428531', name: 'AZZIKRI', gender: 'L', class: 'X5'},
            {nisn: '0096093993', name: 'DEWANGGA PUTRA', gender: 'L', class: 'X5'},
            {nisn: '0091456719', name: 'DIAH RAHMAH KURNIASARI', gender: 'P', class: 'X5'},
            {nisn: '0104468753', name: 'DITA AYU LESTARI', gender: 'P', class: 'X5'},
            {nisn: '0105542388', name: 'GISARINA HANUM PUTRI', gender: 'P', class: 'X5'},
            {nisn: '3100482770', name: 'HAFIZH ROHADI PRATAMA', gender: 'L', class: 'X5'},
            {nisn: '0094651348', name: 'HANAFI RADHITYA FATIN', gender: 'L', class: 'X5'},
            {nisn: '0105833180', name: 'HASYIFA SETIAWAN', gender: 'P', class: 'X5'},
            {nisn: '0106998585', name: 'HAURA AZ-ZAHRA', gender: 'P', class: 'X5'},
            {nisn: '3105215725', name: 'HERU RUKMANA', gender: 'L', class: 'X5'},
            {nisn: '0102189547', name: 'IBNU AHMAD ADLI SAFA', gender: 'L', class: 'X5'},
            {nisn: '0093602226', name: 'KAYLA RIZKY AMALIA', gender: 'P', class: 'X5'},
            {nisn: '0097387466', name: 'MUHAMAD FAKHRIZAL AMANSYAHRONI', gender: 'L', class: 'X5'},
            {nisn: '3104345907', name: 'MUHAMMAD AULIA NIBRAS', gender: 'L', class: 'X5'},
            {nisn: '0091934350', name: 'MUHAMMAD SAKHIY EL AZZAM', gender: 'L', class: 'X5'},
            {nisn: '0107831153', name: 'NABILA MAHARANI', gender: 'P', class: 'X5'},
            {nisn: '0105870031', name: 'NADHIRAH AHWANDJI', gender: 'P', class: 'X5'},
            {nisn: '0096891264', name: 'NURSUTA MUSTAQIM', gender: 'L', class: 'X5'},
            {nisn: '0098733440', name: 'NAZWA AULIA', gender: 'P', class: 'X5'},
            {nisn: '0099869188', name: 'PRITALINCH OCTAVIANI', gender: 'P', class: 'X5'},
            {nisn: '0101485234', name: 'QUINSHA AULIA RAHMANITA', gender: 'P', class: 'X5'},
            {nisn: '0096360292', name: 'RAMA PAGI RAMADHAN', gender: 'L', class: 'X5'},
            {nisn: '0092706569', name: 'RIZKY FAZRI RAMADHAN', gender: 'L', class: 'X5'},
            {nisn: '0101655068', name: 'SHAFIYYAH DEEVASHA MUMTAZ', gender: 'P', class: 'X5'},
            {nisn: '0091085763', name: 'SITI KHADIJAH AL MUNAWAROH', gender: 'P', class: 'X5'},
            {nisn: '0109793398', name: 'VINA BILQIS', gender: 'P', class: 'X5'},
            {nisn: '0109541186', name: 'VINCENTIUS KEVIN GILANG WIBOWO', gender: 'L', class: 'X5'},
            {nisn: '3097050131', name: 'ZAHID ABDURROSYID', gender: 'L', class: 'X5'},
            {nisn: '0097941844', name: 'ZAHRO EKA KURNIAWATI', gender: 'P', class: 'X5'},
        ];

        // Assignment types
        let assignmentTypes = ['X-Catatan Penelitian Geografi', 'Tugas 9 Latihan Soal Penelitian Geografi', 'Tugas 10 Tugas Revisi Proposal Penelitian Geografi, 'Sumatif harian 3 Laporan Penelitian Geografi', 'XII-Tugas 8 Catatan Pembangunan Wilayah, Revolusi Industri, dan Pengaruhnya terhadap Ruang Muka Bumi dan Kesejahteraah', 'Tugas 8 Infografis Smart Home', 'Sumatif harian 3 Pembangunan Wilayah, Revolusi Industri, dan Pengaruhnya terhadap Ruang Muka Bumi dan Kesejahteraah'];

        // Current user
        let currentUser = null;
        let adminPassword = 'admin07';

        // Grade data storage
        let gradeData = [];

        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function goToDashboard() {
            document.getElementById('welcomePage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('fade-in');
        }

        function switchLoginType(type) {
            const studentTab = document.getElementById('studentTab');
            const adminTab = document.getElementById('adminTab');
            const studentForm = document.getElementById('studentLoginForm');
            const adminForm = document.getElementById('adminLoginForm');
            const studentInfo = document.getElementById('studentInfo');
            const adminInfo = document.getElementById('adminInfo');
            
            if (type === 'student') {
                // Update tabs
                studentTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                studentTab.classList.remove('text-gray-600');
                adminTab.classList.remove('bg-white', 'text-green-600', 'shadow-sm');
                adminTab.classList.add('text-gray-600');
                
                // Show/hide forms
                studentForm.classList.remove('hidden');
                adminForm.classList.add('hidden');
                
                // Show/hide info
                studentInfo.classList.remove('hidden');
                adminInfo.classList.add('hidden');
            } else {
                // Update tabs
                adminTab.classList.add('bg-white', 'text-green-600', 'shadow-sm');
                adminTab.classList.remove('text-gray-600');
                studentTab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                studentTab.classList.add('text-gray-600');
                
                // Show/hide forms
                adminForm.classList.remove('hidden');
                studentForm.classList.add('hidden');
                
                // Show/hide info
                adminInfo.classList.remove('hidden');
                studentInfo.classList.add('hidden');
            }
        }

        function loginStudent() {
            const nisn = document.getElementById('studentNISN').value;
            const student = students.find(s => s.nisn === nisn);
            
            if (student) {
                currentUser = student;
                document.getElementById('studentName').textContent = student.name;
                
                // Update profile information
                document.getElementById('profileName').textContent = student.name;
                document.getElementById('profileNISN').textContent = student.nisn;
                document.getElementById('profileClass').textContent = student.class;
                document.getElementById('profileGender').textContent = student.gender === 'L' ? 'Laki-laki' : 'Perempuan';
                
                // Load saved profile photo if exists
                const savedPhoto = localStorage.getItem(`profilePhoto_${student.nisn}`);
                if (savedPhoto) {
                    document.getElementById('profilePhoto').src = savedPhoto;
                    document.getElementById('profilePhoto').classList.remove('hidden');
                    document.getElementById('defaultAvatar').classList.add('hidden');
                } else {
                    document.getElementById('profilePhoto').classList.add('hidden');
                    document.getElementById('defaultAvatar').classList.remove('hidden');
                }
                
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('studentPage').classList.remove('hidden');
                document.getElementById('studentPage').classList.add('fade-in');
                showNotification('Berhasil login sebagai siswa!');
            } else {
                alert('NISN tidak ditemukan!');
            }
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === adminPassword) {
                currentUser = {type: 'admin', name: 'Ali Imron'};
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('adminPage').classList.remove('hidden');
                document.getElementById('adminPage').classList.add('fade-in');
                showNotification('Berhasil login sebagai admin!');
            } else {
                alert('Password admin salah!');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('studentPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('studentNISN').value = '';
            document.getElementById('adminPassword').value = '';
            
            // Reset to student login tab
            switchLoginType('student');
        }

        function toggleGradeInput() {
            const gradeType = document.getElementById('gradeType').value;
            const numberGrade = document.getElementById('numberGrade');
            const letterGrade = document.getElementById('letterGrade');
            
            if (gradeType === 'angka') {
                numberGrade.classList.remove('hidden');
                letterGrade.classList.add('hidden');
            } else if (gradeType === 'huruf') {
                letterGrade.classList.remove('hidden');
                numberGrade.classList.add('hidden');
            } else {
                numberGrade.classList.add('hidden');
                letterGrade.classList.add('hidden');
            }
        }

        function convertToLetter() {
            const numberValue = parseInt(document.getElementById('numberValue').value);
            let letterValue = '';
            
            if (numberValue >= 96) letterValue = 'A++';
            else if (numberValue >= 91) letterValue = 'A+';
            else if (numberValue >= 86) letterValue = 'A';
            else if (numberValue >= 80) letterValue = 'A-';
            else if (numberValue >= 75) letterValue = 'B+';
            else if (numberValue >= 70) letterValue = 'B';
            else if (numberValue >= 65) letterValue = 'B-';
            else if (numberValue >= 62) letterValue = 'C+';
            else if (numberValue >= 60) letterValue = 'C';
            else if (numberValue === 59) letterValue = 'C-';
            else if (numberValue > 0) letterValue = 'D';
            else letterValue = 'E';
            
            document.getElementById('letterValue').value = letterValue;
        }

        function convertToNumber() {
            const letterValue = document.getElementById('letterValue').value;
            let numberValue = '';
            
            switch(letterValue) {
                case 'A++': numberValue = 98; break;
                case 'A+': numberValue = 93; break;
                case 'A': numberValue = 88; break;
                case 'A-': numberValue = 82; break;
                case 'B+': numberValue = 77; break;
                case 'B': numberValue = 72; break;
                case 'B-': numberValue = 67; break;
                case 'C+': numberValue = 63; break;
                case 'C': numberValue = 60; break;
                case 'C-': numberValue = 59; break;
                case 'D': numberValue = 50; break;
                case 'E': numberValue = 0; break;
            }
            
            document.getElementById('numberValue').value = numberValue;
        }

        function submitGrade() {
            const fileUpload = document.getElementById('fileUpload').files[0];
            const gradeType = document.getElementById('gradeType').value;
            const assignmentType = document.getElementById('assignmentType').value;
            
            if (!fileUpload || !gradeType || !assignmentType) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            if (fileUpload.size > 1024 * 1024) {
                alert('Ukuran file maksimal 1MB!');
                return;
            }
            
            const numberValue = document.getElementById('numberValue').value;
            const letterValue = document.getElementById('letterValue').value;
            
            const gradeEntry = {
                class: currentUser.class,
                nisn: currentUser.nisn,
                name: currentUser.name,
                gender: currentUser.gender === 'L' ? 'Laki-laki' : 'Perempuan',
                assignmentType: assignmentType,
                numberGrade: numberValue,
                letterGrade: letterValue,
                fileProof: fileUpload.name,
                date: new Date().toLocaleDateString('id-ID'),
                time: new Date().toLocaleTimeString('id-ID')
            };
            
            // Send to Google Sheets
            sendToGoogleSheets(gradeEntry);
            
            gradeData.push(gradeEntry);
            
            // Reset form
            document.getElementById('fileUpload').value = '';
            document.getElementById('gradeType').value = '';
            document.getElementById('numberValue').value = '';
            document.getElementById('letterValue').value = '';
            document.getElementById('assignmentType').value = '';
            document.getElementById('numberGrade').classList.add('hidden');
            document.getElementById('letterGrade').classList.add('hidden');
        }

        function sendToGoogleSheets(data) {
            // Google Apps Script Web App URL - Replace with your deployed URL
            const scriptURL = 'https://script.google.com/macros/s/AKfycbz8buWpdjMAgHiGy5nT7NeLCUmzjsp1tb7BrxQawiAmqIubqdDfYFsjIhdYuVm-NClSnA/exec';
            
            const formData = new FormData();
            formData.append('class', data.class);
            formData.append('nisn', data.nisn);
            formData.append('name', data.name);
            formData.append('gender', data.gender);
            formData.append('assignmentType', data.assignmentType);
            formData.append('numberGrade', data.numberGrade);
            formData.append('letterGrade', data.letterGrade);
            formData.append('fileProof', data.fileProof);
            formData.append('date', data.date);
            formData.append('time', data.time);
            
            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    showNotification('Data berhasil dikirim ke Data Base!');
                } else {
                    showNotification('Data tersimpan lokal - koneksi ke Data Base gagal');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Data tersimpan lokal - koneksi ke Data Base gagal');
            });
        }

        // New function that combines loading and showing detailed recap
        function loadAndShowGradeRecap() {
            if (!currentUser || !currentUser.nisn) {
                alert('Silakan login terlebih dahulu!');
                return;
            }
            
            // Show loading animation on the button
            const button = event.target.closest('button');
            const originalContent = button.innerHTML;
            button.innerHTML = `
                <svg class="w-8 h-8 animate-spin" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
            `;
            button.disabled = true;
            
            // Load data and then show detailed page
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5-YH4IRwxf6aAIG6zyT_XFa-CD9ev60Bs0iF_GZ60aovblWb2LMdtZCkpKYs_DOxG7xciQmROdfYN/pub?gid=946061728&single=true&output=csv';
            
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    const grades = parseCSVData(csvText);
                    const studentGrades = grades.filter(grade => grade.nisn === currentUser.nisn);
                    
                    // Restore button
                    button.innerHTML = originalContent;
                    button.disabled = false;
                    
                    if (studentGrades.length === 0) {
                        alert('Belum ada data nilai untuk NISN Anda di database');
                        return;
                    }
                    
                    // Show notification and go to detailed page
                    showNotification(`Berhasil memuat ${studentGrades.length} data nilai!`);
                    showDetailedGradeRecap();
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    // Restore button
                    button.innerHTML = originalContent;
                    button.disabled = false;
                    alert('Gagal memuat data. Periksa koneksi internet Anda.');
                });
        }

        function loadGradeRecap() {
            const recapDiv = document.getElementById('gradeRecap');
            const statsDiv = document.getElementById('gradeStats');
            
            // Show loading state with animation
            recapDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center animate-spin">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p class="text-purple-600 font-medium">Memuat data dari database nilai...</p>
                    <p class="text-gray-400 text-xs mt-1">Mohon tunggu sebentar</p>
                </div>
            `;
            
            // Use the correct CSV export URL with specific sheet ID
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5-YH4IRwxf6aAIG6zyT_XFa-CD9ev60Bs0iF_GZ60aovblWb2LMdtZCkpKYs_DOxG7xciQmROdfYN/pub?gid=946061728&single=true&output=csv';
            
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    const grades = parseCSVData(csvText);
                    const studentGrades = grades.filter(grade => grade.nisn === currentUser.nisn);
                    
                    if (studentGrades.length === 0) {
                        recapDiv.innerHTML = `
                            <div class="text-center py-8">
                                <div class="w-12 h-12 bg-gray-200 rounded-full mx-auto mb-3 flex items-center justify-center">
                                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <p class="text-gray-500 font-medium">Belum ada data nilai</p>
                                <p class="text-gray-400 text-xs mt-1">NISN Anda belum terdaftar di database nilai</p>
                            </div>
                        `;
                        statsDiv.classList.add('hidden');
                        return;
                    }
                    
                    // Calculate statistics
                    const totalGrades = studentGrades.length;
                    const numericGrades = studentGrades.map(g => parseInt(g.numberGrade)).filter(g => !isNaN(g));
                    const averageGrade = numericGrades.length > 0 ? 
                        (numericGrades.reduce((a, b) => a + b, 0) / numericGrades.length).toFixed(1) : 0;
                    
                    // Update statistics
                    document.getElementById('totalGrades').textContent = totalGrades;
                    document.getElementById('averageGrade').textContent = averageGrade;
                    statsDiv.classList.remove('hidden');
                    
                    // Sort grades by date (newest first)
                    studentGrades.sort((a, b) => {
                        const dateA = new Date(a.date.split('/').reverse().join('-'));
                        const dateB = new Date(b.date.split('/').reverse().join('-'));
                        return dateB - dateA;
                    });
                    
                    let html = '<div class="space-y-3">';
                    studentGrades.forEach((grade, index) => {
                        const gradeColor = getGradeColor(grade.letterGrade);
                        const isLatest = index === 0;
                        
                        html += `
                            <div class="bg-white p-4 rounded-lg border-l-4 ${gradeColor.border} hover:shadow-md transition duration-300 ${isLatest ? 'ring-2 ring-purple-200' : ''}">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <h4 class="font-semibold text-gray-800">${grade.assignmentType}</h4>
                                            ${isLatest ? '<span class="bg-purple-100 text-purple-600 text-xs px-2 py-1 rounded-full font-medium">Terbaru</span>' : ''}
                                        </div>
                                        <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                                            <span class="flex items-center space-x-1">
                                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                                </svg>
                                                <span>Nilai: ${grade.numberGrade}</span>
                                            </span>
                                            <span class="flex items-center space-x-1">
                                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                                </svg>
                                                <span>${grade.date}</span>
                                            </span>
                                            <span class="flex items-center space-x-1">
                                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                                </svg>
                                                <span>${grade.time}</span>
                                            </span>
                                        </div>
                                        ${grade.fileProof ? `
                                            <div class="flex items-center space-x-1 text-xs text-gray-500">
                                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                                </svg>
                                                <span>Bukti: ${grade.fileProof}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold ${gradeColor.text} mb-1">${grade.letterGrade}</div>
                                        <div class="text-xs text-gray-500">Grade</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    
                    recapDiv.innerHTML = html;
                    showNotification(`Berhasil memuat ${totalGrades} data nilai!`);
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    recapDiv.innerHTML = `
                        <div class="text-center py-8">
                            <div class="w-12 h-12 bg-red-100 rounded-full mx-auto mb-3 flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <p class="text-red-600 font-medium">Gagal memuat data</p>
                            <p class="text-gray-400 text-xs mt-1">Periksa koneksi internet Anda</p>
                        </div>
                    `;
                    statsDiv.classList.add('hidden');
                });
        }

        function getGradeColor(letterGrade) {
            // Group grades by main category for consistent coloring
            if (letterGrade.startsWith('A')) {
                return { text: 'text-emerald-600', border: 'border-emerald-500' };
            } else if (letterGrade.startsWith('B')) {
                return { text: 'text-blue-600', border: 'border-blue-500' };
            } else if (letterGrade.startsWith('C')) {
                return { text: 'text-yellow-600', border: 'border-yellow-500' };
            } else if (letterGrade === 'D') {
                return { text: 'text-orange-600', border: 'border-orange-500' };
            } else if (letterGrade === 'E') {
                return { text: 'text-red-600', border: 'border-red-500' };
            } else {
                return { text: 'text-gray-600', border: 'border-gray-500' };
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const grades = [];
            
            // Skip header row (index 0)
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line) {
                    const columns = parseCSVLine(line);
                    if (columns.length >= 10) {
                        grades.push({
                            class: columns[0],
                            nisn: columns[1],
                            name: columns[2],
                            gender: columns[3],
                            assignmentType: columns[4],
                            numberGrade: columns[5],
                            letterGrade: columns[6],
                            fileProof: columns[7],
                            date: columns[8],
                            time: columns[9]
                        });
                    }
                }
            }
            
            return grades;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // Admin Functions
        function showChangePassword() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">Ganti Password Admin</h3>
                <div class="max-w-md space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Lama</label>
                        <input type="password" id="oldPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Baru</label>
                        <input type="password" id="newPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password Baru</label>
                        <input type="password" id="confirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                    <button onclick="changePassword()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition duration-300">
                        Ganti Password
                    </button>
                </div>
            `;
        }

        function changePassword() {
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (oldPassword !== adminPassword) {
                alert('Password lama salah!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Konfirmasi password tidak cocok!');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('Password baru minimal 6 karakter!');
                return;
            }
            
            adminPassword = newPassword;
            showNotification('Password berhasil diubah!');
            document.getElementById('oldPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function showStudentManagement() {
            const content = document.getElementById('adminContent');
            let html = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">Kelola Data Siswa</h3>
                <div class="mb-6">
                    <button onclick="showAddStudentForm()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300 mr-2">
                        Tambah Siswa
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2 text-left">NISN</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Nama</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">L/P</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Kelas</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            students.forEach((student, index) => {
                html += `
                    <tr>
                        <td class="border border-gray-300 px-4 py-2">${student.nisn}</td>
                        <td class="border border-gray-300 px-4 py-2">${student.name}</td>
                        <td class="border border-gray-300 px-4 py-2">${student.gender}</td>
                        <td class="border border-gray-300 px-4 py-2">${student.class}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <button onclick="deleteStudent(${index})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition duration-300">
                                Hapus
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            content.innerHTML = html;
        }

        function showAddStudentForm() {
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Siswa Baru</h3>
                <div class="max-w-md space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                        <input type="text" id="newNISN" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                        <input type="text" id="newName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Kelamin</label>
                        <select id="newGender" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Pilih jenis kelamin</option>
                            <option value="L">Laki-laki</option>
                            <option value="P">Perempuan</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                        <input type="text" id="newClass" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="addStudent()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition duration-300">
                            Tambah Siswa
                        </button>
                        <button onclick="showStudentManagement()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition duration-300">
                            Kembali
                        </button>
                    </div>
                </div>
            `;
        }

        function addStudent() {
            const nisn = document.getElementById('newNISN').value;
            const name = document.getElementById('newName').value;
            const gender = document.getElementById('newGender').value;
            const studentClass = document.getElementById('newClass').value;
            
            if (!nisn || !name || !gender || !studentClass) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            if (students.find(s => s.nisn === nisn)) {
                alert('NISN sudah terdaftar!');
                return;
            }
            
            students.push({
                nisn: nisn,
                name: name.toUpperCase(),
                gender: gender,
                class: studentClass
            });
            
            showNotification('Siswa berhasil ditambahkan!');
            showStudentManagement();
        }

        function deleteStudent(index) {
            if (confirm('Yakin ingin menghapus siswa ini?')) {
                students.splice(index, 1);
                showNotification('Siswa berhasil dihapus!');
                showStudentManagement();
            }
        }

        function showAssignmentManagement() {
            const content = document.getElementById('adminContent');
            let html = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">Kelola Bentuk Tugas</h3>
                <div class="mb-6">
                    <div class="flex space-x-2">
                        <input type="text" id="newAssignment" placeholder="Nama bentuk tugas baru" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <button onclick="addAssignment()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition duration-300">
                            Tambah
                        </button>
                    </div>
                </div>
                <div class="space-y-2">
            `;
            
            assignmentTypes.forEach((assignment, index) => {
                html += `
                    <div class="flex justify-between items-center bg-white p-4 rounded-lg border">
                        <span class="font-medium text-gray-800">${assignment}</span>
                        <button onclick="deleteAssignment(${index})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition duration-300">
                            Hapus
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function addAssignment() {
            const newAssignment = document.getElementById('newAssignment').value.trim();
            
            if (!newAssignment) {
                alert('Mohon masukkan nama bentuk tugas!');
                return;
            }
            
            if (assignmentTypes.includes(newAssignment)) {
                alert('Bentuk tugas sudah ada!');
                return;
            }
            
            assignmentTypes.push(newAssignment);
            showNotification('Bentuk tugas berhasil ditambahkan!');
            showAssignmentManagement();
            updateAssignmentOptions();
        }

        function deleteAssignment(index) {
            if (confirm('Yakin ingin menghapus bentuk tugas ini?')) {
                assignmentTypes.splice(index, 1);
                showNotification('Bentuk tugas berhasil dihapus!');
                showAssignmentManagement();
                updateAssignmentOptions();
            }
        }

        function updateAssignmentOptions() {
            const select = document.getElementById('assignmentType');
            if (select) {
                select.innerHTML = '<option value="">Pilih bentuk tugas</option>';
                assignmentTypes.forEach(assignment => {
                    select.innerHTML += `<option value="${assignment}">${assignment}</option>`;
                });
            }
        }

        function showGradeRecap() {
            const content = document.getElementById('adminContent');
            let html = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">Rekap Nilai Keseluruhan</h3>
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-2">Data disinkronkan langsung dari Database Nilai</p>
                    <button onclick="loadFromSpreadsheet()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300 mr-2">
                        Muat dari Spreadsheet
                    </button>
                    <button onclick="exportToCSV()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">
                        Export CSV
                    </button>
                </div>
                <div id="adminGradeTable">
                    <p class="text-gray-600">Klik "Muat dari Spreadsheet" untuk menampilkan data terbaru.</p>
                </div>
            `;
            
            content.innerHTML = html;
        }

        function exportToCSV() {
            if (gradeData.length === 0) {
                alert('Tidak ada data untuk diekspor!');
                return;
            }
            
            let csv = 'KELAS,NISN,NAMA PESERTA DIDIK,JENIS KELAMIN,BENTUK TUGAS,NILAI ANGKA,NILAI HURUF,BUKTI UNGGAH,TANGGAL,WAKTU\n';
            
            gradeData.forEach(grade => {
                csv += `${grade.class},${grade.nisn},"${grade.name}",${grade.gender},"${grade.assignmentType}",${grade.numberGrade},${grade.letterGrade},"${grade.fileProof}",${grade.date},${grade.time}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rekap_nilai_geografi.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Data berhasil diekspor ke CSV!');
        }

        function loadFromSpreadsheet() {
            const tableDiv = document.getElementById('adminGradeTable');
            tableDiv.innerHTML = '<p class="text-gray-600">Memuat data dari database nilai...</p>';
            
            // Use the correct CSV export URL with specific sheet ID
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5-YH4IRwxf6aAIG6zyT_XFa-CD9ev60Bs0iF_GZ60aovblWb2LMdtZCkpKYs_DOxG7xciQmROdfYN/pub?gid=946061728&single=true&output=csv';
            
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    const grades = parseCSVData(csvText);
                    
                    if (grades.length === 0) {
                        tableDiv.innerHTML = '<p class="text-gray-600">Tidak ada data nilai di database nilai.</p>';
                        return;
                    }
                    
                    // Update global gradeData for export functionality
                    gradeData = grades;
                    
                    let html = `
                        <div class="mb-4">
                            <p class="text-sm text-green-600 font-medium"> Data berhasil dimuat dari database nilai (${grades.length} record)</p>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300 text-sm">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="border border-gray-300 px-2 py-2 text-left">Kelas</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">NISN</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Nama</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">L/P</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Bentuk Tugas</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Nilai Angka</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Nilai Huruf</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Bukti</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Tanggal</th>
                                        <th class="border border-gray-300 px-2 py-2 text-left">Waktu</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    grades.forEach(grade => {
                        html += `
                            <tr>
                                <td class="border border-gray-300 px-2 py-2">${grade.class}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.nisn}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.name}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.gender}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.assignmentType}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.numberGrade}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.letterGrade}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.fileProof}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.date}</td>
                                <td class="border border-gray-300 px-2 py-2">${grade.time}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    tableDiv.innerHTML = html;
                    showNotification('Data berhasil dimuat dari Database Nilai!');
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    tableDiv.innerHTML = '<p class="text-red-600">Gagal memuat data dari spreadsheet. Periksa koneksi internet atau URL spreadsheet.</p>';
                });
        }

        function changeProfilePhoto() {
            document.getElementById('profilePhotoInput').click();
        }

        function updateProfilePhoto() {
            const fileInput = document.getElementById('profilePhotoInput');
            const file = fileInput.files[0];
            
            if (file) {
                // Check file size (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    alert('Ukuran file maksimal 2MB!');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    alert('File harus berupa gambar!');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = e.target.result;
                    
                    // Update profile photo display
                    document.getElementById('profilePhoto').src = photoData;
                    document.getElementById('profilePhoto').classList.remove('hidden');
                    document.getElementById('defaultAvatar').classList.add('hidden');
                    
                    // Save to localStorage
                    if (currentUser && currentUser.nisn) {
                        localStorage.setItem(`profilePhoto_${currentUser.nisn}`, photoData);
                        showNotification('Foto profil berhasil diperbarui!');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Global variables for detailed grade page
        let allStudentGrades = [];
        let filteredStudentGrades = [];

        // Show detailed grade recap page
        function showDetailedGradeRecap() {
            if (!currentUser || !currentUser.nisn) {
                alert('Silakan login terlebih dahulu!');
                return;
            }
            
            // Update student info
            document.getElementById('detailedStudentName').textContent = currentUser.name;
            document.getElementById('detailedStudentNISN').textContent = currentUser.nisn;
            document.getElementById('detailedStudentClass').textContent = currentUser.class;
            document.getElementById('detailedStudentGender').textContent = currentUser.gender === 'L' ? 'Laki-laki' : 'Perempuan';
            document.getElementById('detailedStudentInfo').textContent = `Data lengkap nilai ${currentUser.name}`;
            
            // Hide student page and show detailed page
            document.getElementById('studentPage').classList.add('hidden');
            document.getElementById('detailedGradePage').classList.remove('hidden');
            document.getElementById('detailedGradePage').classList.add('fade-in');
            
            // Load data automatically
            refreshDetailedData();
        }

        // Back to student page
        function backToStudentPage() {
            document.getElementById('detailedGradePage').classList.add('hidden');
            document.getElementById('studentPage').classList.remove('hidden');
        }

        // Refresh detailed data
        function refreshDetailedData() {
            const contentDiv = document.getElementById('detailedGradeContent');
            
            // Show loading state
            contentDiv.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center animate-spin">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p class="text-indigo-600 font-medium">Memuat data dari database nilai...</p>
                    <p class="text-gray-400 text-sm mt-1">Mohon tunggu sebentar</p>
                </div>
            `;
            
            // Fetch data from CSV
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5-YH4IRwxf6aAIG6zyT_XFa-CD9ev60Bs0iF_GZ60aovblWb2LMdtZCkpKYs_DOxG7xciQmROdfYN/pub?gid=946061728&single=true&output=csv';
            
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    const allGrades = parseCSVData(csvText);
                    allStudentGrades = allGrades.filter(grade => grade.nisn === currentUser.nisn);
                    
                    if (allStudentGrades.length === 0) {
                        contentDiv.innerHTML = `
                            <div class="text-center py-12">
                                <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <p class="text-gray-500 font-medium">Belum ada data nilai</p>
                                <p class="text-gray-400 text-sm mt-1">NISN Anda belum terdaftar di Database</p>
                            </div>
                        `;
                        resetStatistics();
                        return;
                    }
                    
                    // Update statistics
                    updateDetailedStatistics();
                    
                    // Update filter options
                    updateFilterOptions();
                    
                    // Apply initial filter (show all)
                    filteredStudentGrades = [...allStudentGrades];
                    filterGrades();
                    
                    showNotification(`Berhasil memuat ${allStudentGrades.length} data nilai!`);
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    contentDiv.innerHTML = `
                        <div class="text-center py-12">
                            <div class="w-16 h-16 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <svg class="w-8 h-8 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <p class="text-red-600 font-medium">Gagal memuat data</p>
                            <p class="text-gray-400 text-sm mt-1">Periksa koneksi internet Anda</p>
                            <button onclick="refreshDetailedData()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300">
                                Coba Lagi
                            </button>
                        </div>
                    `;
                    resetStatistics();
                });
        }

        // Update detailed statistics
        function updateDetailedStatistics() {
            const totalGrades = allStudentGrades.length;
            const numericGrades = allStudentGrades.map(g => parseInt(g.numberGrade)).filter(g => !isNaN(g));
            const averageGrade = numericGrades.length > 0 ? 
                (numericGrades.reduce((a, b) => a + b, 0) / numericGrades.length).toFixed(1) : 0;
            
            // Update main statistics
            document.getElementById('detailedTotalGrades').textContent = totalGrades;
            document.getElementById('detailedAverageGrade').textContent = averageGrade;
            
            // Update grade distribution - group by main grade categories
            const gradeCounts = { A: 0, B: 0, C: 0, D: 0, E: 0 };
            allStudentGrades.forEach(grade => {
                const mainGrade = grade.letterGrade.charAt(0); // Get first character (A, B, C, D, E)
                if (gradeCounts.hasOwnProperty(mainGrade)) {
                    gradeCounts[mainGrade]++;
                }
            });
            
            document.getElementById('gradeCountA').textContent = gradeCounts.A;
            document.getElementById('gradeCountB').textContent = gradeCounts.B;
            document.getElementById('gradeCountC').textContent = gradeCounts.C;
            document.getElementById('gradeCountD').textContent = gradeCounts.D;
            document.getElementById('gradeCountE').textContent = gradeCounts.E;
        }

        // Reset statistics
        function resetStatistics() {
            document.getElementById('detailedTotalGrades').textContent = '0';
            document.getElementById('detailedAverageGrade').textContent = '-';
            document.getElementById('gradeCountA').textContent = '0';
            document.getElementById('gradeCountB').textContent = '0';
            document.getElementById('gradeCountC').textContent = '0';
            document.getElementById('gradeCountD').textContent = '0';
            document.getElementById('gradeCountE').textContent = '0';
        }

        // Update filter options
        function updateFilterOptions() {
            const assignmentFilter = document.getElementById('filterAssignmentType');
            const uniqueAssignments = [...new Set(allStudentGrades.map(g => g.assignmentType))];
            
            assignmentFilter.innerHTML = '<option value="">Semua Tugas</option>';
            uniqueAssignments.forEach(assignment => {
                assignmentFilter.innerHTML += `<option value="${assignment}">${assignment}</option>`;
            });
        }

        // Filter and sort grades
        function filterGrades() {
            const assignmentFilter = document.getElementById('filterAssignmentType').value;
            const letterFilter = document.getElementById('filterLetterGrade').value;
            const sortBy = document.getElementById('sortBy').value;
            
            // Apply filters
            filteredStudentGrades = allStudentGrades.filter(grade => {
                const matchesAssignment = !assignmentFilter || grade.assignmentType === assignmentFilter;
                const matchesLetter = !letterFilter || grade.letterGrade === letterFilter;
                return matchesAssignment && matchesLetter;
            });
            
            // Apply sorting
            filteredStudentGrades.sort((a, b) => {
                switch(sortBy) {
                    case 'date_desc':
                        return new Date(b.date.split('/').reverse().join('-')) - new Date(a.date.split('/').reverse().join('-'));
                    case 'date_asc':
                        return new Date(a.date.split('/').reverse().join('-')) - new Date(b.date.split('/').reverse().join('-'));
                    case 'grade_desc':
                        return parseInt(b.numberGrade) - parseInt(a.numberGrade);
                    case 'grade_asc':
                        return parseInt(a.numberGrade) - parseInt(b.numberGrade);
                    case 'assignment':
                        return a.assignmentType.localeCompare(b.assignmentType);
                    default:
                        return 0;
                }
            });
            
            // Render filtered results
            renderDetailedGradeTable();
        }

        // Render detailed grade table
        function renderDetailedGradeTable() {
            const contentDiv = document.getElementById('detailedGradeContent');
            
            if (filteredStudentGrades.length === 0) {
                contentDiv.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <p class="text-gray-500 font-medium">Tidak ada data sesuai filter</p>
                        <p class="text-gray-400 text-sm mt-1">Coba ubah pengaturan filter</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">No</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">Bentuk Tugas</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">Nilai Angka</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">Nilai Huruf</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">Bukti Upload</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">Tanggal</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 border-b">Waktu</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredStudentGrades.forEach((grade, index) => {
                const gradeColor = getGradeColor(grade.letterGrade);
                const rowClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                
                html += `
                    <tr class="${rowClass} hover:bg-blue-50 transition duration-200">
                        <td class="py-4 px-4 border-b border-gray-200">
                            <span class="font-medium text-gray-700">${index + 1}</span>
                        </td>
                        <td class="py-4 px-4 border-b border-gray-200">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 ${gradeColor.border.replace('border-', 'bg-')} rounded-full"></div>
                                <span class="font-medium text-gray-800">${grade.assignmentType}</span>
                            </div>
                        </td>
                        <td class="py-4 px-4 border-b border-gray-200">
                            <span class="font-bold text-lg ${gradeColor.text}">${grade.numberGrade}</span>
                        </td>
                        <td class="py-4 px-4 border-b border-gray-200">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${gradeColor.text} ${gradeColor.border.replace('border-', 'bg-')}/10 ${gradeColor.border}">
                                ${grade.letterGrade}
                            </span>
                        </td>
                        <td class="py-4 px-4 border-b border-gray-200">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-sm text-gray-600 truncate max-w-xs" title="${grade.fileProof}">${grade.fileProof}</span>
                            </div>
                        </td>
                        <td class="py-4 px-4 border-b border-gray-200">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-sm text-gray-600">${grade.date}</span>
                            </div>
                        </td>
                        <td class="py-4 px-4 border-b border-gray-200">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-sm text-gray-600">${grade.time}</span>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 text-center text-sm text-gray-500">
                    Menampilkan ${filteredStudentGrades.length} dari ${allStudentGrades.length} total nilai
                </div>
            `;
            
            contentDiv.innerHTML = html;
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('filterAssignmentType').value = '';
            document.getElementById('filterLetterGrade').value = '';
            document.getElementById('sortBy').value = 'date_desc';
            filterGrades();
        }

        // Export student grades to CSV
        function exportStudentGrades() {
            if (allStudentGrades.length === 0) {
                alert('Tidak ada data untuk diekspor!');
                return;
            }
            
            let csv = 'No,Bentuk Tugas,Nilai Angka,Nilai Huruf,Bukti Upload,Tanggal,Waktu\n';
            
            filteredStudentGrades.forEach((grade, index) => {
                csv += `${index + 1},"${grade.assignmentType}",${grade.numberGrade},${grade.letterGrade},"${grade.fileProof}",${grade.date},${grade.time}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rekap_nilai_${currentUser.name.replace(/\s+/g, '_')}_${currentUser.nisn}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Data berhasil diekspor ke CSV!');
        }

        // Initialize assignment options when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateAssignmentOptions();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978ee589f490ce39',t:'MTc1NjgzNTkxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>





